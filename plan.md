# Micro-Iframe 项目计划

## 📋 项目概述

Micro-Iframe 是一个基于 iframe 的微前端框架，支持多框架混用、独立部署，提供完整的生命周期管理、路由同步和通信机制。

### 技术栈

- **语言**: TypeScript 5
- **构建工具**: Vite 7
- **构建系统**: Turbo 2 (Monorepo)
- **包管理**: pnpm 9 (Workspace)
- **代码质量**: ESLint 9, Prettier 3, Commitlint 20
- **Git Hooks**: Husky 9, lint-staged 16

### 项目结构

```
micro-iframe/
├── packages/
│   ├── core/          # 主应用框架核心库
│   ├── sdk/           # 子应用接入 SDK
│   ├── types/         # 共享类型定义
│   └── utils/         # 工具函数库
├── apps/
│   ├── host/          # 主应用示例
│   ├── micro-react/   # React 子应用示例
│   ├── micro-vue/     # Vue 子应用示例
│   └── micro-html/    # HTML 子应用示例
└── ...
```

## ✅ 已完成功能

### 核心功能

- [x] **应用注册与管理**
  - 应用注册器 (AppRegistry)
  - 应用加载器 (AppLoader)
  - 应用实例管理

- [x] **生命周期管理**
  - mount/unmount/update 生命周期钩子
  - 生命周期消息通信
  - 子应用生命周期管理器

- [x] **路由同步**
  - History 和 Hash 路由模式支持
  - 主应用与子应用路由自动同步
  - 路由匹配规则（字符串/正则/函数）
  - 路由变化监听

- [x] **通信机制**
  - 基于 postMessage 的统一通信协议
  - 事件发布订阅
  - 请求/响应模式
  - 消息类型系统

- [x] **框架适配**
  - React 应用适配器
  - Vue 应用适配器
  - 原生 HTML/JS 支持
  - 路由同步 Hook (useRouteSync)

- [x] **类型系统**
  - 完整的 TypeScript 类型定义
  - 共享类型包 (@micro-iframe/types)
  - 类型导出和复用

- [x] **工具函数**
  - DOM 操作工具
  - 路由工具函数
  - 通用工具方法

### 示例应用

- [x] 主应用示例 (host)
- [x] React 子应用示例 (micro-react)
- [x] Vue 子应用示例 (micro-vue)
- [x] HTML 子应用示例 (micro-html)

### 开发工具链

- [x] Monorepo 配置 (Turbo + pnpm workspace)
- [x] 代码检查 (ESLint)
- [x] 代码格式化 (Prettier)
- [x] 提交规范 (Commitlint)
- [x] Git Hooks (Husky)
- [x] 类型检查 (TypeScript)

## 🚀 待办事项

### 高优先级

#### 1. 文档完善
- [ ] **API 文档**
  - [ ] 完善核心 API 文档
  - [ ] 添加 SDK API 详细说明
  - [ ] 补充类型定义文档
  - [ ] 添加最佳实践指南

- [ ] **使用指南**
  - [ ] 快速开始教程
  - [ ] 集成指南（主应用/子应用）
  - [ ] 路由配置详解
  - [ ] 通信机制使用示例
  - [ ] 错误处理指南

- [ ] **示例代码**
  - [ ] 更多实际场景示例
  - [ ] 复杂路由场景示例
  - [ ] 跨应用通信示例
  - [ ] 状态管理集成示例

#### 2. 功能增强
- [ ] **应用缓存**
  - [ ] iframe 缓存策略优化
  - [ ] 应用预加载机制
  - [ ] 缓存清理策略

- [ ] **错误处理**
  - [ ] 更完善的错误边界
  - [ ] 错误重试机制
  - [ ] 错误上报和监控
  - [ ] 超时处理优化

- [ ] **性能优化**
  - [ ] iframe 懒加载
  - [ ] 资源预加载
  - [ ] 内存泄漏检测和修复
  - [ ] 性能监控指标

#### 3. 测试
- [ ] **单元测试**
  - [ ] 核心功能单元测试
  - [ ] SDK 功能单元测试
  - [ ] 工具函数测试
  - [ ] 测试覆盖率目标: 80%+

- [ ] **集成测试**
  - [ ] 主应用与子应用集成测试
  - [ ] 路由同步测试
  - [ ] 通信机制测试
  - [ ] 生命周期测试

- [ ] **E2E 测试**
  - [ ] 完整流程 E2E 测试
  - [ ] 多应用切换测试
  - [ ] 跨浏览器兼容性测试

### 中优先级

#### 4. 框架适配扩展
- [ ] **Angular 适配器**
  - [ ] Angular 应用初始化
  - [ ] Angular 路由同步
  - [ ] Angular 生命周期集成

- [ ] **其他框架支持**
  - [ ] Svelte 适配器
  - [ ] Solid 适配器
  - [ ] 通用适配器模板

#### 5. 开发体验优化
- [ ] **开发工具**
  - [ ] DevTools 扩展
  - [ ] 调试工具
  - [ ] 性能分析工具

- [ ] **CLI 工具**
  - [ ] 项目初始化 CLI
  - [ ] 应用生成器
  - [ ] 配置检查工具

#### 6. 配置增强
- [ ] **应用配置**
  - [ ] 更多配置选项
  - [ ] 配置验证
  - [ ] 配置热更新

- [ ] **路由配置**
  - [ ] 路由守卫支持
  - [ ] 路由元信息
  - [ ] 动态路由配置

### 低优先级

#### 7. 高级特性
- [ ] **状态管理**
  - [ ] 全局状态共享机制
  - [ ] 状态同步策略
  - [ ] 状态持久化

- [ ] **资源管理**
  - [ ] 共享资源加载
  - [ ] 资源版本管理
  - [ ] CDN 资源优化

- [ ] **安全增强**
  - [ ] CSP 策略支持
  - [ ] 消息来源验证
  - [ ] XSS 防护增强

#### 8. 生态建设
- [ ] **插件系统**
  - [ ] 插件架构设计
  - [ ] 插件注册机制
  - [ ] 官方插件开发

- [ ] **社区支持**
  - [ ] 问题反馈渠道
  - [ ] 贡献指南
  - [ ] 社区文档

## 🔧 技术债务

### 代码质量
- [ ] 代码审查和重构
- [ ] 统一错误处理模式
- [ ] 优化类型定义
- [ ] 减少 any 类型使用

### 性能优化
- [ ] 减少不必要的重渲染
- [ ] 优化消息传递性能
- [ ] 减少内存占用
- [ ] 优化构建产物大小

### 兼容性
- [ ] 浏览器兼容性测试
- [ ] 移动端适配
- [ ] 旧版本浏览器支持策略

## 📊 里程碑规划

### 里程碑 1: 基础功能完善 (当前阶段)
**目标**: 完善核心功能，提升稳定性

- [x] 核心框架实现
- [x] 基础示例应用
- [ ] 完善错误处理
- [ ] 基础单元测试
- [ ] 基础文档

**预计时间**: 已完成

### 里程碑 2: 文档和测试 (下一阶段)
**目标**: 完善文档体系，建立测试覆盖

- [ ] 完整 API 文档
- [ ] 使用指南和教程
- [ ] 单元测试覆盖率达到 80%+
- [ ] 集成测试
- [ ] E2E 测试基础

**预计时间**: 2-3 周

### 里程碑 3: 功能增强 (中期)
**目标**: 增强功能，优化性能

- [ ] 应用缓存优化
- [ ] 性能监控
- [ ] 错误处理增强
- [ ] Angular 适配器
- [ ] 开发工具

**预计时间**: 3-4 周

### 里程碑 4: 生态建设 (长期)
**目标**: 建立完整生态

- [ ] 插件系统
- [ ] CLI 工具
- [ ] 更多框架适配
- [ ] 社区文档和指南
- [ ] 最佳实践总结

**预计时间**: 4-6 周

## 🎯 短期目标 (1-2 周)

1. **完善文档**
   - 补充 API 文档
   - 编写使用指南
   - 添加代码示例

2. **测试基础**
   - 搭建测试框架
   - 编写核心功能单元测试
   - 测试覆盖率目标: 60%+

3. **错误处理优化**
   - 完善错误边界
   - 添加错误重试机制
   - 优化错误提示

## 📝 注意事项

### 开发规范
- 遵循项目编码规范（JavaScript/Vue/Python）
- 使用 ESLint 和 Prettier 保证代码质量
- 遵循 Commitlint 提交规范
- 代码审查后再合并

### 版本管理
- 遵循语义化版本 (Semantic Versioning)
- 重大变更需要更新文档
- 保持向后兼容性

### 性能要求
- 框架本身体积 < 50KB (gzipped)
- 应用加载时间 < 1s
- 路由切换时间 < 100ms

## 🔗 相关资源

- [项目 README](./README.md)
- [Turbo 文档](https://turbo.build/repo/docs)
- [Vite 文档](https://vitejs.dev/)
- [pnpm 文档](https://pnpm.io/)

---

**最后更新**: 2024-12-19
**维护者**: 项目团队

